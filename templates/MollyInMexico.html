<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Special Message</title>

    <!-- 引入Google字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500&display=swap" rel="stylesheet">

    <style>
        /* 變數設定 */
        :root {
            /* 字體大小 */
            --font-size: 30px;
            /* 文字左右邊的留白 */
            --text-padding: 30px;
        }

        body {
            /* 設定字體 */
            font-family: 'Noto Serif TC', serif;
            /* 設定字體大小 */
            font-size: var(--font-size);
            /* 背景顏色 */
            background-color: #f4f4f4;
            /* 使用flexbox使內容置中 */
            display: flex;
            justify-content: center;
            align-items: center;
            /* 設定視窗高度 */
            height: 100vh;
            /* 使用文字左右邊的留白變數 */
            padding: 0 var(--text-padding);
        }

        #text {
            /* 1. 保留所有的空格、換行和縮排，就像你在原始碼中看到的那樣。
               2. 文字不會自動換行，除非你明確地在文本中加入了換行。 */
            white-space: pre;
            position: relative;
            /* 設定最大寬度 */
            max-width: 90%;
            /* 設定內部左右的留白 */
            padding: 0 20px;
            /* 設定文字換行 */
            overflow-wrap: break-word;
        }

        #text::after {
            /* 設定閃爍的光標 */
            content: '|';
            position: absolute;
            animation: blink 0.75s step-end infinite;
        }

        /* 光標閃爍動畫 */
        @keyframes blink {

            from,
            to {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div id="text"></div>

    <!-- YouTube背景音樂 -->
    <iframe width="0" height="0" src="https://www.youtube.com/embed/puqpMg4WYso?autoplay=1&loop=1&playlist=puqpMg4WYso"
        frameborder="0" allowfullscreen></iframe>

    <script>
        // 當網頁加載完成後執行此函數
        window.onload = function () {
            // 使用fetch API從Flask伺服器獲取內容
            fetch('/get-content')
                .then(response => response.json())  // 解析響應為JSON
                .then(data => {
                    const content = data.content;
                    // 使用 content 進行所需的操作，例如: 將content添加到 #text div

                    // 獲取HTML中的text元素
                    const textElement = document.getElementById('text');

                    // 打字速度變數，數字越小打字越快
                    const typingSpeed = 200;

                    let index = 0;


                    function typeText() {
                        /* 如果還沒打完，繼續打字 */
                        if (index < content.length) {
                            textElement.innerHTML += content[index];

                            // 以下這段程式碼是當content變數的文字寫在程式碼裡面(如下)才需要:
                            // const content = `
                            // 我跟一 個女孩	擁抱，
                            // 我像嗑了藥，瘋狂地想她，
                            // 我現在在船上，暈到要吐了出來，
                            // 但我很享受這個感覺。`;

                            // 如果當前字符是換行，則添加<br>到HTML
                            // if (content[index] === '\n') {
                            //     textElement.innerHTML += '<br>';
                            // } else if (content[index] === '\t') { // 檢查是否為Tab
                            //     textElement.innerHTML += '&nbsp;&nbsp;&nbsp;&nbsp;'; // 將Tab轉換為四個空格
                            // } else {
                            //     textElement.innerHTML += content[index];
                            // }

                            index++;
                            /* 使用setTimeout來控制打字速度 */
                            setTimeout(typeText, typingSpeed);
                        }
                    }



                    /* 開始打字 */
                    typeText();
                })
                .catch(error => {
                    // 如果在獲取內容時出現錯誤，則在控制台中打印錯誤消息
                    console.error('Error fetching content:', error);
                });
        }
    </script>
</body>

</html>